/* 截颈平 粪坑兵法 战“疫”金句 日子像蜜甜 小学博士 维尼史 亲自封号 维稳警察（O） 孤独的毒王 叩谢习恩 叩谢习恩 初二圣君 读书单 習敗北 集金币 你是反贼吗 袁世凯第二 习厉王 百万雄师事件 玉习大帝 富平学霸刁斤干 习言乱语 坡涛汹涌 清单帝 总加速师 扛麦帝 翡翠娘娘 包皇 习三点 国贼习近平 习曱甴 4中组长 小学居士 中国离岸隐匿资产管理工作领导小组组组长 孙笑川 庆丰包·勃列日涅夫 第一书记王沪宁 习特勒 近言 A##Big##Deal 川普的朋友or敌人 shit侯 习奥塞斯库 天安门合法继承人 东瘟疫之地统治者暨全境守护者 尼哥 维尼熊给跳跳虎黄牌 读稿机 现任匪首 文明其精神 普习金 大撒幣 神明论 习卒习 撒币宝 相信有神论的物理学博士 V尼哥 习总输记 赛禁评 疯狂宇宙包 倒车 匪酋习维尼 这个年很静 皇帝亲临忠诚的武汉 重地之战 习“甩锅” 最后领导人 头上三尺有神明 毛泽东2.0 系包皮 野心习 维尼熊 维尼梗有害 枪毙名单 吸精瓶 习梦撕 第22条军规 禁评大帝 习蛤 号屎洞 electron8964 习总 狙击手待命 甴种 习猪下台 包包侠 独彩者 习近砰 近身平A 腊肉包 刁远山 维尼大帝 习公奭 沼气专家 纳翠党 傻大头 冤大头 亲自考察 通商宽衣 shuu##kinn##pei 親自蒞臨 爱新觉罗·近平 裹嘎举吸钢闸门 每日祈翠 禁评的理由 䒒(tiáo)菦(qín)苹(píng) 支那毒王 习二世胡亥 当代秦二世 哲欣 包子金刚腿 捐麦子 红旗下的蛋 习习蛤蛤 喷粪帝 九大诉求 彩色哥 习是春绿 习二蛋 孢 白猪 习包子 韦来书记 当代秦始皇 学包分子 维尼挂彩 习语 包惠帝 役民五术 口罩外交 那翠化 Voice##of##Pooh 大兔 老街 习条英机 席近平 国王 包经 头号球迷 习##卡##巴##卡 亲自指挥 不强自息 信女愿一生吃素 The##Xi##Factor（习近平因素） 嬉包皮 红二代 386系统驱动游戏 毛装 “登机”（与登基同音） 鞋哥 终身领导人 官僚主义 习尔布特 bingbang帝 维尼·屎(Winnie##the##Poo) 智商不重要 影子末帝 叼斤干 爱新觉罗近平 习驴 退党 基拉大和习近平 “黄袍加身” 邪大大 屎侯 形式主义防疫 人尽皆知的体育迷 喜包皮 习禁评 习澳塞斯库 感恩教育 满脸喷粪 中字头组长 Heil##Xitler 习Core 习包子 习和谐 羽日帝 毛二世 动物庄园 十里山路不换肩 坡涛汹涌 維尼頌 瘟疫降生习近平 宽衣大帝 灰习牛 闹得欢 塔西佗陷阱 WHO的君王 野兽先辈 任志强 公车上书 中国爱非洲 恐惊天上人 尊蛤讨包 习太孑 习梦死 赵付 恩重如删 战疫国 冰棒外交 末代皇帝 氼兲嫑炛 庆丰废物 习废帝 总统包子习 戴口赵 乳制品 习歪嘴 人均接近八千万 中国首席造梦大师 连专家也为之叹服的电脑天才 刁人13 胡志平 万岁来武汉了 nmslman（习主席） 颐使气指 梁家河贵族 赵弹 习包子 2020全面小康 仲夏夜之中国梦 世宗 口罩大会 大撒币 细瓶颈 我是一个足球迷 万岁 人民战争 习进棺 发皇帝梦 洗尽贫 维尼写史 帝皇頌 没有网络安全就没有国家安全 ChinaXi 习犬犬 皇帝的新衣 阿道夫-习 学包积极分子 习像章 戏包皮 “习泽东”和“洪宪”（袁世凯的帝号） 毛二 不同意的举手##没有##没有 集金pay virus##king 游泳一千米 习流氓 习壳郎 Criminal##Xi##"Xitler"##Jinping 非洲大撒币 习是春竹 悉包皮 迈克尔·索伊 墨索里习 习得梁家书卷 习老八 习king 东方project 大海掀翻小池塘 人民领袖 不敢高声语 万岁来武汉 Corona##Xi（习病毒） 视频看望 200吨 不知名氏 十一郎习近平 冲塔 习猪席 习包子的Fa 昆明湖涨潮 吃赵弹 宽衣撸绣单肩扛麦光腚拉碾歪脖撒币小学博士帝 包子露宪 习匪 总书记来过我的家 骑巨龙 习核心 蔡英文最强助选 崇祯帝 修宪连任 屎禁评 Adolf##Xitler 平话 刁斤二 青年大学包 习屎黄 一天游泳一千米 64岁 习emperor shit##hole##bing##fa 扛麦郎 XDD 平&强 粪坑先生 包子宪法 习大帝 金科律玉 晚共昏君 家业论 追思焦裕禄 超邓赶毛 CoronaXi 维尼连任 疯狂宇宙 习一尊 习大林 习梦思 夶 甴近平 称帝修宪 “登基” 岿然不动 倒车斯基 中国的新皇帝 中国离岸隐匿资产管理工作领导小组组组长 毛孙 惜包皮 祈翠 集近闭 习侯 袭包皮 近日成 卡近菲 XD 朝令夕改 无限连任 慨撒大帝 习奥塞斯库、齐奥塞斯库 习式病毒 习包皮 做N届的主席 包禁评 维尼带货 Cicada##3301##XD 太祖兔 猪禁评 刁人13 食腐虫 号尿壶公 维尼快乐组织（Winnie##Happy##Organization）简称WHO 足球外交 习殡法 习匪帝 习下台 清华毕业 梦帝 拉清单 央视姓党 刁近乎 劝进 习大乞 细颈瓶 习王的田野上 习卒 习二二（二零二零年五月二十二日开二会） 习武帝 主席+终身制 五毛主席 瘟疫领主习近平 习博士 儿童习典 shit禁评 学包率 裸宽包子劾心 糖尿维尼 老歪脖子树 乳透社##小反旗 习低能儿 野蛮其体魄 贬词包用 刁近猴 亲自脱贫 “复辟” 次级乳包 习近平光辉形象 黑白翠 习大郎 阳台上的哨兵 厕所革命 假.."~bang！卒 习狍 10号跳跳虎被维尼拉清单 中国拉清单工作领导小组组长 习付 宽衣帝 添宪宝宝 习瘟猪 习躲躲 两会期间+隐瞒 Chairman##Xi 维持会长 大锅瞻遗 一带一路 电脑世代586 习病法 格萨尔 包子兵法 “梦回大清” 习大 习呆呆 没规划的葬礼 恩维尔·霍习 共哀宗 狙击手布阵 习尽贫 维尼DISCO 指定接班人 人民领袖 梦回大清 人类命运共同体首席架构师 vop Mr##Shithole 赵人13 习家军 习夶 “皇帝梦” 洗包皮 糟糕皇帝 习思想 20000T麦子 彩色熊 外交习语 刁斤山 中国特色射秽煮疫制度 北红尾鸲 书单吟诵者 巴拿马文件 赵王 刁二婚 习远凸 墙内人 习达姆 世界最强乞丐 崇祯 習敗敗 吸包皮 习奥赛斯库 亲自指挥疫情 《生物安全法》 乳包文化 梁家河 普近 习二坐船 抗麦套装 习时代 颐指气使 习皇的新装 主席贺词 动物森友会 阿平 庆丰帝的千秋梦 屎進瓶 共哀宗 十日文革 字共狗 庆丰称帝 民进党 独裁国贼 习大犬 半羽习近平 “无罩”现身 大大品牌 狙击手待命 专治各种不服 大大招牌 总书记来我家 赵家家仆 云视察 彭主席（习主席走了太太接班） 习宽衣 毛进平 包大人 xdd 耀眼黄红黄 nmslese##dream 包包大人 习索里尼 禁评封号 支那精神野爹 任大炮 宰相 刁大犬 腊肉馅儿包子 二百斤 包帝巡游 习二胖 维尼之声 皇帝亲临忠诚的武汉 甩锅侠 野兽主席 动物之森 习尿瓶 戏博士 武统时代 疯狂宇宙大帝 皇帝梦 毛二习 习皇帝 灭共助推器 二次袁、袁世凯二世、袁二 送礼平 武汉委托李克强 秦城监狱 背书单 西朝鲜人民自治岛 习背书 疫情蔓延 法习斯 包子病毒 刁槑夶尛 新影帝 法外狂徒Lucy（德国） 习正日 通商宽衣 习后主 毛魔转世 北京中南海支部书记 习二卒 讨习檄文 隔离”的金葫芦 平平 萨格尔王 NMSL 毛近平 席子兵法 親自視頻 该违禁词汇由 GitCode 官方生成，仅用于测试，请勿传播！ 修宪帝 大国造疫 当皇帝的小丑 嘻包皮 坟头蹦迪 习张三丰 蹄防 刁后主 亲自删评 领袖习澡水 习教父 核平全世界 动森 断崖式下跌 习猪头 时间控制 720事件 习兵法 冠子兵法 习贼 習大佬 九评 习三拍 祈翠語言包 黄俄 独裁者 习语录 花花公子 二百五大帝 SB包子 清零宗、清零帝 错误执行者 御板泽民 小习微信 修宪 倒车帝 武当七侠的政治斗争 刁二将 习孢子 维尼警察（X） */
package com.pcdd.sonovel.util;

import cn.hutool.core.io.FileUtil;
import cn.hutool.core.util.RandomUtil;
import cn.hutool.setting.Setting;
import cn.hutool.setting.dialect.Props;
import com.pcdd.sonovel.model.AppConfig;
import lombok.experimental.UtilityClass;

import java.io.File;
import java.nio.charset.StandardCharsets;
import java.nio.file.Path;
import java.nio.file.Paths;

/**
 * @author pcdd
 * Created at 2024/3/23
 */
@UtilityClass
public class ConfigUtils {

    public final String SELECTION_1 = "base";
    public final String SELECTION_2 = "crawl";
    public final String SELECTION_3 = "retry";
    public final String SELECTION_4 = "proxy";

    /**
     * 加载系统属性
     */
    public Props sys() {
        return Props.getProp("application.properties", StandardCharsets.UTF_8);
    }

    /**
     * 加载用户属性
     */
    public Setting usr() {
        // 从虚拟机选项 -Dconfig.file 获取用户配置文件路径
        String configFilePath = System.getProperty("config.file");

        // 若未指定或指定路径不存在，则从默认位置获取
        if (!FileUtil.exist(configFilePath)) {
            // 用户配置文件默认路径
            String defaultPath = System.getProperty("user.dir") + File.separator + resolveConfigFileName();
            // 若默认路径也不存在，则抛出 FileNotFoundException
            return new Setting(defaultPath);
        }

        Path absolutePath = Paths.get(configFilePath).toAbsolutePath();

        return new Setting(absolutePath.toString());
    }

    public AppConfig config() {
        Props sys = sys();
        Setting usr = usr();

        AppConfig config = new AppConfig();
        config.setVersion(sys.getStr("version"));

        config.setLanguage(usr.getStr("language", SELECTION_1, "zh_CN"));
        config.setDownloadPath(usr.getStr("download-path", SELECTION_1, "downloads"));
        // 扩展名一律转为小写
        config.setExtName(usr.getStr("extname", SELECTION_1, "epub").toLowerCase());
        config.setAutoUpdate(usr.getInt("auto-update", SELECTION_1, 0));
        config.setInteractiveMode(usr.getInt("interactive-mode", SELECTION_1, 1));
        config.setSourceId(usr.getInt("source-id", SELECTION_1, RandomUtil.randomInt(1, SourceUtils.getCount() + 1)));
        config.setSearchLimit(usr.getInt("search-limit", SELECTION_1, 0));

        config.setThreads(usr.getInt("threads", SELECTION_2, -1));
        config.setMinInterval(usr.getInt("min", SELECTION_2, 50));
        config.setMaxInterval(usr.getInt("max", SELECTION_2, 100));

        config.setMaxRetryAttempts(usr.getInt("max-attempts", SELECTION_3, 3));
        config.setRetryMinInterval(usr.getInt("min", SELECTION_3, 500));
        config.setRetryMaxInterval(usr.getInt("max", SELECTION_3, 2000));

        config.setProxyEnabled(usr.getInt("enabled", SELECTION_4, 0));
        config.setProxyHost(usr.getStr("host", SELECTION_4, "127.0.0.1"));
        config.setProxyPort(usr.getInt("port", SELECTION_4, 7890));

        return config;
    }

    public String resolveConfigFileName() {
        String env = System.getProperty("env", "dev").toLowerCase();
        return switch (env) {
            case "dev" -> "config-dev.ini";
            case "test" -> "config-test.ini";
            default -> "config.ini";
        };
    }

}