/* 北京中南海支部书记 维尼警察（X） 喜包皮 “登机”（与登基同音） 包经 习尽贫 夶 彭主席（习主席走了太太接班） 习言乱语 virus##king 每日祈翠 亲自考察 习包皮 甴种 宽衣帝 撒币宝 青年大学包 不敢高声语 习是春竹 二次袁、袁世凯二世、袁二 超邓赶毛 xdd 甩锅侠 习包子 习猪下台 习废帝 初二圣君 昆明湖涨潮 老街 亲自封号 颐使气指 习习蛤蛤 中国拉清单工作领导小组组长 包子病毒 习夶 “梦回大清” 现任匪首 习二坐船 慨撒大帝 天安门合法继承人 毛二 匪酋习维尼 冤大头 维尼梗有害 习大郎 战疫国 不同意的举手##没有##没有 人民领袖 任志强 领袖习澡水 爱新觉罗近平 狙击手布阵 包帝巡游 九评 集近闭 习奥塞斯库、齐奥塞斯库 维尼史 “登基” 退党 赵付 毛二世 疫情蔓延 两会期间+隐瞒 维尼熊 连专家也为之叹服的电脑天才 国王 抗麦套装 爱新觉罗·近平 shit侯 赵王 习澳塞斯库 大大品牌 习皇帝 讨习檄文 Mr##Shithole 川普的朋友or敌人 中国首席造梦大师 习驴 最后领导人 SB包子 习时代 半羽习近平 习蛤 闹得欢 羽日帝 NMSL 书单吟诵者 习王的田野上 习得梁家书卷 席近平 戏博士 皇帝亲临忠诚的武汉 国贼习近平 習敗敗 法习斯 信女愿一生吃素 独裁者 亲自删评 20000T麦子 习孢子 習大佬 嬉包皮 习贼 二百五大帝 我是一个足球迷 厕所革命 叩谢习恩 指定接班人 习兵法 “皇帝梦” 小学居士 头上三尺有神明 386系统驱动游戏 黑白翠 习卒 日子像蜜甜 冲塔 帝皇頌 包包侠 无限连任 习低能儿 口罩大会 白猪 《生物安全法》 不强自息 维尼之声 裹嘎举吸钢闸门 晚共昏君 蹄防 独裁国贼 刁人13 修宪连任 任大炮 習敗北 包皇 赵弹 Criminal##Xi##"Xitler"##Jinping 红二代 糖尿维尼 习躲躲 包子兵法 外交习语 百万雄师事件 刁大犬 习大犬 vop 习正日 中国离岸隐匿资产管理工作领导小组组组长 叼斤干 习后主 武统时代 瘟疫领主习近平 惜包皮 主席+终身制 中国离岸隐匿资产管理工作领导小组组组长 坡涛汹涌 习张三丰 纳翠党 系包皮 坡涛汹涌 维尼带货 习梦死 末代皇帝 大撒幣 支那毒王 习索里尼 赵家家仆 读稿机 翡翠娘娘 动物之森 相信有神论的物理学博士 枪毙名单 食腐虫 10号跳跳虎被维尼拉清单 狙击手待命 习二胖 梦帝 捐麦子 维尼写史 The##Xi##Factor（习近平因素） 扛麦帝 动物庄园 屎進瓶 瘟疫降生习近平 Corona##Xi（习病毒） 200吨 毛泽东2.0 这个年很静 习背书 战“疫”金句 宽衣撸绣单肩扛麦光腚拉碾歪脖撒币小学博士帝 习殡法 动森 习近砰 維尼頌 骑巨龙 傻大头 席子兵法 亲自指挥 习厉王 总书记来我家 错误执行者 习king 习壳郎 孢 包包大人 祈翠語言包 Cicada##3301##XD 习“甩锅” 庆丰包·勃列日涅夫 塔西佗陷阱 墙内人 仲夏夜之中国梦 习尿瓶 时间控制 Chairman##Xi 习武帝 习语 第22条军规 没规划的葬礼 Heil##Xitler 五毛主席 金科律玉 非洲大撒币 刁二将 细颈瓶 共哀宗 包子金刚腿 狙击手待命 学包分子 习屎黄 近日成 腊肉馅儿包子 云视察 恩维尔·霍习 庆丰称帝 维尼挂彩 富平学霸刁斤干 彩色熊 习大帝 近身平A 习歪嘴 习特勒 大兔 悉包皮 野心习 小学博士 糟糕皇帝 假.."~bang！卒 习三拍 沼气专家 习奥赛斯库 北红尾鸲 终身领导人 平话 刁近猴 习是春绿 禁评的理由 小习微信 官僚主义 乳透社##小反旗 中国爱非洲 修宪帝 刁斤二 阳台上的哨兵 口罩外交 崇祯帝 习下台 智商不重要 shit禁评 通商宽衣 花花公子 那翠化 满脸喷粪 基拉大和习近平 习宽衣 叩谢习恩 乳制品 习一尊 没有网络安全就没有国家安全 ChinaXi CoronaXi 习付 亲自脱贫 氼兲嫑炛 彩色哥 親自蒞臨 尊蛤讨包 习像章 腊肉包 习大 巴拿马文件 皇帝的新衣 习包子 役民五术 包惠帝 䒒(tiáo)菦(qín)苹(píng) 玉习大帝 毛魔转世 大锅瞻遗 崇祯 习##卡##巴##卡 袭包皮 包子露宪 习三点 习emperor 包大人 总加速师 吸包皮 习教父 毛进平 A##Big##Deal 墨索里习 万岁 阿道夫-习 庆丰废物 断崖式下跌 禁评封号 “习泽东”和“洪宪”（袁世凯的帝号） 普近 修宪 习二世胡亥 法外狂徒Lucy（德国） 平&强 袁世凯第二 尼哥 你是反贼吗 拉清单 维尼·屎(Winnie##the##Poo) 乳包文化 “黄袍加身” 刁近乎 习侯 皇帝梦 红旗下的蛋 冰棒外交 毛孙 中字头组长 维尼连任 一天游泳一千米 中国的新皇帝 习包子的Fa 细瓶颈 劝进 坟头蹦迪 bingbang帝 鞋哥 孤独的毒王 蔡英文最强助选 第一书记王沪宁 习总输记 万岁来武汉 集金pay 哲欣 习条英机 清单帝 親自視頻 号尿壶公 习梦思 习二蛋 感恩教育 读书单 次级乳包 集金币 清零宗、清零帝 习曱甴 习奥塞斯库 XD 疯狂宇宙包 背书单 戏包皮 electron8964 御板泽民 刁后主 老歪脖子树 Adolf##Xitler 习猪席 甴近平 主席贺词 习家军 习皇的新装 习二二（二零二零年五月二十二日开二会） 包禁评 shuu##kinn##pei 习进棺 宽衣大帝 近言 倒车帝 屎禁评 学包率 不知名氏 嘻包皮 人类命运共同体首席架构师 该违禁词汇由 GitCode 官方生成，仅用于测试，请勿传播！ 倒车 东方project 一带一路 大大招牌 64岁 皇帝亲临忠诚的武汉 WHO的君王 梁家河 字共狗 影子末帝 刁斤山 习大乞 总统包子习 孙笑川 习尔布特 世宗 刁二婚 专治各种不服 儿童习典 二百斤 岿然不动 习太孑 大撒币 习禁评 野蛮其体魄 独彩者 视频看望 武当七侠的政治斗争 武汉委托李克强 习博士 清华毕业 动物森友会 邪大大 祈翠 shit##hole##bing##fa 粪坑兵法 朝令夕改 维尼快乐组织（Winnie##Happy##Organization）简称WHO 迈克尔·索伊 支那精神野爹 颐指气使 重地之战 粪坑先生 秦城监狱 毛近平 公车上书 大海掀翻小池塘 屎侯 习卒习 习猪头 2020全面小康 习思想 nmslese##dream 隔离”的金葫芦 十一郎习近平 世界最强乞丐 通商宽衣 洗包皮 贬词包用 家业论 V尼哥 喷粪帝 nmslman（习主席） 学包积极分子 耀眼黄红黄 梁家河贵族 “无罩”现身 冠子兵法 普习金 卡近菲 XDD 吃赵弹 游泳一千米 疯狂宇宙 习大林 中国特色射秽煮疫制度 吸精瓶 习包子 灰习牛 东瘟疫之地统治者暨全境守护者 扛麦郎 习匪帝 刁槑夶尛 韦来书记 习式病毒 洗尽贫 央视姓党 送礼平 习Core 头号球迷 裸宽包子劾心 做N届的主席 习二卒 号屎洞 黄俄 习老八 习呆呆 习总 萨格尔王 发皇帝梦 胡志平 刁远山 倒车斯基 习语录 习狍 人尽皆知的体育迷 人均接近八千万 维尼DISCO 九大诉求 灭共助推器 禁评大帝 习达姆 阿平 习瘟猪 格萨尔 庆丰帝的千秋梦 刁人13 当皇帝的小丑 赛禁评 毛二习 习匪 宰相 习公奭 添宪宝宝 西朝鲜人民自治岛 新影帝 赵人13 习核心 包子宪法 习远凸 恐惊天上人 十日文革 足球外交 太祖兔 维尼大帝 文明其精神 称帝修宪 当代秦始皇 追思焦裕禄 戴口赵 疯狂宇宙大帝 民进党 形式主义防疫 习近平光辉形象 电脑世代586 万岁来武汉了 梦回大清 共哀宗 恩重如删 习流氓 习犬犬 总书记来过我的家 野兽主席 猪禁评 720事件 维稳警察（O） 人民战争 习梦撕 十里山路不换肩 维持会长 大国造疫 “复辟” 4中组长 毛装 平平 核平全世界 维尼熊给跳跳虎黄牌 当代秦二世 Voice##of##Pooh 亲自指挥疫情 神明论 习和谐 习病法 人民领袖 截颈平 野兽先辈 */
package com.pcdd.sonovel.merge;

import cn.hutool.core.io.FileUtil;
import cn.hutool.core.io.resource.ResourceUtil;
import io.documentnode.epub4j.domain.*;
import io.documentnode.epub4j.epub.EpubReader;
import io.documentnode.epub4j.epub.EpubWriter;
import lombok.SneakyThrows;
import org.junit.jupiter.api.*;


@TestMethodOrder(MethodOrderer.OrderAnnotation.class)
class EpubTest {

    @Test
    @Order(1)
    @SneakyThrows
    void createEpub() {
        Book book = new Book();
        book.getMetadata().addTitle("武神主宰");
        book.getMetadata().addAuthor(new Author("暗魔师"));
        book.getMetadata().addDescription("天武大陆一代传奇秦尘，因好友背叛意外陨落武域。三百年后，他转生在一个受尽欺凌的王府私生子身上，利用前世造诣，凝神功、炼神丹，逆天而上，强势崛起，从此踏上一段震惊大陆的惊世之旅。");
        book.setCoverImage(new Resource(ResourceUtil.readBytes("cover.jpg"), "cover.jpg"));

        // 循环添加章节
        for (int i = 1; i <= 10; i++) {
            String chapterTitle = String.format("第%03d章", i);
            // 第二个参数必须确保唯一
            Resource resource = new Resource(ResourceUtil.readBytes("chapter.html"), i + ".html");
            book.addSection(chapterTitle, resource);
        }

        EpubWriter epubWriter = new EpubWriter();
        epubWriter.write(book, FileUtil.getOutputStream("test.epub"));
    }

    @Test
    @Order(2)
    @DisplayName("读取 EPUB")
    @SneakyThrows
    void readEpub() {
        EpubReader epubReader = new EpubReader();
        Book book = epubReader.readEpub(FileUtil.getInputStream("test.epub"));
        Metadata metadata = book.getMetadata();

        // 书名
        System.out.println(metadata.getTitles().get(0));
        // 作者
        System.out.println(metadata.getAuthors().get(0));
        // 简介
        System.out.println(metadata.getDescriptions().get(0));
        // 章节数
        System.out.println(book.getContents().size());
        // 正文
        System.out.println(new String(book.getContents().get(0).getData()));

        int i = 0;
        // 遍历目录
        for (TOCReference tocReference : book.getTableOfContents().getTocReferences()) {
            if (i++ == 10) break;
            // 章节名
            System.out.println(tocReference.getTitle());
            // 正文
            // System.out.println(new String(tocReference.getResource().getData()));
        }
    }

}